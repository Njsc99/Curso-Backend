<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="/">
      <i class="bi bi-shop"></i> E-Commerce
    </a>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">
            <i class="bi bi-house"></i> Inicio
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/products">
            <i class="bi bi-grid"></i> Catálogo
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/realtimeproducts">
            <i class="bi bi-lightning"></i> Tiempo Real
          </a>
        </li>
      </ul>
      
      <div class="d-flex align-items-center">
        <form class="d-flex me-3" action="/products" method="GET">
          <div class="input-group">
            <input class="form-control form-control-sm" 
                   type="search" 
                   placeholder="Buscar productos..." 
                   name="query"
                   style="min-width: 200px;">
            <button class="btn btn-outline-light btn-sm" type="submit">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </form>
        
        <div class="btn-group me-2">
          <button type="button" 
                  class="btn btn-outline-light btn-sm dropdown-toggle" 
                  data-bs-toggle="dropdown" 
                  aria-expanded="false">
            <i class="bi bi-cart3"></i> Carrito
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <h6 class="dropdown-header">Acceder a carrito</h6>
            </li>
            <li>
              <form class="px-3 py-2" id="cartAccessForm">
                <div class="mb-2">
                  <input type="text" 
                         class="form-control form-control-sm" 
                         id="cartIdInput" 
                         placeholder="ID del carrito">
                </div>
                <button type="submit" class="btn btn-primary btn-sm w-100">
                  <i class="bi bi-box-arrow-in-right"></i> Acceder
                </button>
              </form>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item" href="#" onclick="createNewCart()">
                <i class="bi bi-plus-circle"></i> Crear nuevo carrito
              </a>
            </li>
          </ul>
        </div>

      </div>
    </div>
  </div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const cartForm = document.getElementById('cartAccessForm');
  if (cartForm) {
    cartForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const cartId = document.getElementById('cartIdInput').value.trim();
      if (cartId) {
        window.location.href = `/carts/${cartId}`;
      } else {
        alert('Por favor ingresa un ID de carrito válido');
      }
    });
  }
});

async function createNewCart() {
  try {
    const response = await fetch('/api/carts', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    if (response.ok) {
      const newCart = await response.json();
      alert(`Nuevo carrito creado con ID: ${newCart.payload.id}`);
      window.location.href = `/carts/${newCart.payload.id}`;
    } else {
      alert('Error al crear el carrito');
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Error de conexión');
  }
}


</script>
